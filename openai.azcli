RESOURCE_GROUP='OpenAI-Demo'
LOCATION=eastus
VNET_NAME='vnet-1'
PV_SUBNET_NAME='PrivateLink-Subnet'

az openai create --name myOpenai --resource-group $RESOURCE_GROUP --location $LOCATION --sku Standard --public-network-access Disabled

az network private-endpoint create --name openai-privateEndpointName --resource-group $RESOURCE_GROUP --vnet-name $VNET_NAME --subnet $PV_SUBNET_NAME --private-connection-resource-id $ (az openai show --name myOpenai --resource-group $RESOURCE_GROUP --query id --output tsv) --group-id openai

az network private-dns zone create --name privatelink.api.openai.ms --resource-group $RESOURCE_GROUP
az network private-dns link vnet create --name openAi-privateDnsLink --resource-group $RESOURCE_GROUP --virtual-network $VNET_NAME --zone-name privatelink.api.openai.ms --registration-enabled false

az network private-dns record-set a create --name myOpenai --zone-name privatelink.api.openai.ms --resource-group $RESOURCE_GROUP
az network private-dns record-set a add-record --record-set-name myOpenai --zone-name privatelink.api.openai.ms --resource-group $RESOURCE_GROUP --ipv4-address $ (az network private-endpoint show --name openai-privateEndpointName --resource-group $RESOURCE_GROUP --query "customDnsConfigs[0].ipAddresses[0]" --output tsv)
